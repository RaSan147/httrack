name: Build WinHTTrack for Windows

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    name: Build WinHTTrack GUI (.exe)

    steps:
    - name: ğŸ“¥ Checkout HTTrack Source
      uses: actions/checkout@v3

    - name: ğŸ“¥ Download Prebuilt zlib (x64)
      run: |
        git clone https://github.com/OSDVF/zlib-win-x64.git zlib

    - name: ğŸ” Copy core source files to src_win
      run: |
        xcopy src\*.* src_win\ /S /Y

    - name: ğŸ§° Setup MSBuild
      uses: microsoft/setup-msbuild@v1.3.1

    - name: ğŸ› ï¸ Build WinHTTrack with MSBuild
      run: |
        msbuild src_win\WinHTTrack.dsp /p:Configuration=Release /p:Platform=x64 /t:Build
      env:
        INCLUDE: ${{ github.workspace }}\zlib\include
        LIB: ${{ github.workspace }}\zlib\lib

    - name: ğŸ“¦ Package WinHTTrack
      run: |
        mkdir dist
        copy src_win\Release\WinHTTrack.exe dist\
        copy zlib\bin\zlib1.dll dist\
        if exist lang (xcopy lang dist\lang\ /E /I /Y)
        if exist lang.def (copy lang.def dist\)
        
        echo =========================
        echo ğŸ“ Contents of dist folder:
        echo =========================
        dir dist /S /B

        powershell Compress-Archive -Path dist\* -DestinationPath WinHTTrack-Windows.zip

    - name: ğŸ“¤ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: WinHTTrack-Build
        path: WinHTTrack-Windows.zip
